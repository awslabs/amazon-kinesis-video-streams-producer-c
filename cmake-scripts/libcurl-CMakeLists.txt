cmake_minimum_required(VERSION 2.8)

project(libcurl-download NONE)

find_program(MAKE_EXE NAMES make)

if (DEFINED CMAKE_OSX_SYSROOT AND NOT CMAKE_OSX_SYSROOT STREQUAL "")
  set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -isysroot${CMAKE_OSX_SYSROOT}")
endif()

set(CONFIG_COMMAND ${CMAKE_CURRENT_BINARY_DIR}/build/src/project_libcurl/buildconf ${CMAKE_CURRENT_BINARY_DIR}/build/src/project_libcurl/configure --prefix=${OPEN_SRC_INSTALL_PREFIX}  --with-ssl=${OPENSSL_DIR})
if (DEFINED BUILD_LIBCURL_DESTINATION_PLATFORM AND NOT BUILD_LIBCURL_DESTINATION_PLATFORM STREQUAL OFF)
  set(CONFIG_COMMAND ${CONFIG_COMMAND} --build=${BUILD_LIBCURL_HOST_PLATFORM} --host=${BUILD_LIBCURL_DESTINATION_PLATFORM})
endif()

message("curl config command ${CONFIG_COMMAND}")

include(ExternalProject)
ExternalProject_Add(project_libcurl
    GIT_REPOSITORY    https://github.com/curl/curl.git
    GIT_TAG           curl-7_68_0
    PREFIX            ${CMAKE_CURRENT_BINARY_DIR}/build
    CONFIGURE_COMMAND ${CONFIG_COMMAND}
    BUILD_COMMAND     ${MAKE_EXE}
    BUILD_IN_SOURCE   TRUE
    INSTALL_COMMAND   ${MAKE_EXE} install
    TEST_COMMAND      ""
)
